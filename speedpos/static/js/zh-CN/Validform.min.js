/*
 é€šç”¨è¡¨å•éªŒè¯æ–¹æ³•
 Validform version 5.3.1
 By sean during April 7, 2010 - February 21, 2013
 For more information, please visit http://validform.rjboy.cn
 Validform is available under the terms of the MIT license.

 Demo:
 $(".demoform").Validform({//$(".demoform")æŒ‡æ˜æ˜¯å“ªä¸€è¡¨å•éœ€è¦éªŒè¯?,åç§°éœ€åŠ åœ¨formè¡¨å•ä¸?;
 btnSubmit:"#btn_sub", //#btn_subæ˜¯è¯¥è¡¨å•ä¸‹è¦ç»‘å®šç‚¹å‡»æäº¤è¡¨å•äº‹ä»¶çš„æŒ‰é’?;å¦‚æœformå†…å«æœ‰submitæŒ‰é’®è¯¥å‚æ•°å¯çœç•¥;
 btnReset:".btn_reset",//å¯é€‰é¡¹ .btn_resetæ˜¯è¯¥è¡¨å•ä¸‹è¦ç»‘å®šç‚¹å‡»é‡ç½®è¡¨å•äº‹ä»¶çš„æŒ‰é’?;
 tiptype:1, //å¯é€‰é¡¹ 1=>pop box,2=>side tip(parent.next.find; with default pop),3=>side tip(siblings; with default pop),4=>side tip(siblings; none pop)ï¼Œé»˜è®¤ä¸º1ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªfunctionå‡½æ•°ï¼Œè‡ªå®šä¹‰æç¤ºä¿¡æ¯çš„æ˜¾ç¤ºæ–¹å¼ï¼ˆå¯ä»¥å®ç°ä½ æƒ³è¦çš„ä»»ä½•æ•ˆæœï¼Œå…·ä½“å‚è§demoé¡µï¼‰;
 ignoreHidden:false,//å¯é€‰é¡¹ true | false é»˜è®¤ä¸ºfalseï¼Œå½“ä¸ºtrueæ—¶å¯¹:hiddençš„è¡¨å•å…ƒç´ å°†ä¸åšéªŒè¯;
 dragonfly:false,//å¯é€‰é¡¹ true | false é»˜è®¤falseï¼Œå½“ä¸ºtrueæ—¶ï¼Œå€¼ä¸ºç©ºæ—¶ä¸åšéªŒè¯ï¼?
 tipSweep:true,//å¯é€‰é¡¹ true | false é»˜è®¤ä¸ºfalseï¼Œåªåœ¨è¡¨å•æäº¤æ—¶è§¦å‘æ£€æµ‹ï¼Œbluräº‹ä»¶å°†ä¸ä¼šè§¦å‘æ£€æµ‹ï¼ˆå®æ—¶éªŒè¯ä¼šåœ¨åå°è¿›è¡Œï¼Œä¸ä¼šæ˜¾ç¤ºæ£€æµ‹ç»“æœï¼‰;
 label:".label",//å¯é€‰é¡¹ é€‰æ‹©ç¬¦ï¼Œåœ¨æ²¡æœ‰ç»‘å®šnullmsgæ—¶æŸ¥æ‰¾è¦æ˜¾ç¤ºçš„æç¤ºæ–‡å­—ï¼Œé»˜è®¤æŸ¥æ‰¾".Validform_label"ä¸‹çš„æ–‡å­—;
 showAllError:false,//å¯é€‰é¡¹ true | falseï¼Œtrueï¼šæäº¤è¡¨å•æ—¶æ‰€æœ‰é”™è¯¯æç¤ºä¿¡æ¯éƒ½ä¼šæ˜¾ç¤ºï¼Œfalseï¼šä¸€ç¢°åˆ°éªŒè¯ä¸é€šè¿‡çš„å°±åœæ­¢æ£€æµ‹åé¢çš„å…ƒç´ ï¼Œåªæ˜¾ç¤ºè¯¥å…ƒç´ çš„é”™è¯¯ä¿¡æ¯;
 postonce:true, //å¯é€‰é¡¹ è¡¨å•æ˜¯å¦åªèƒ½æäº¤ä¸€æ¬¡ï¼Œtrueå¼€å¯ï¼Œä¸å¡«åˆ™é»˜è®¤å…³é—?;
 ajaxPost:true, //ä½¿ç”¨ajaxæ–¹å¼æäº¤è¡¨å•æ•°æ®ï¼Œé»˜è®¤falseï¼Œæäº¤åœ°å€å°±æ˜¯actionæŒ‡å®šåœ°å€;
 datatype:{//ä¼ å…¥è‡ªå®šä¹‰datatypeç±»å‹ï¼Œå¯ä»¥æ˜¯æ­£åˆ™ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ï¼ˆå‡½æ•°å†…ä¼šä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼‰;
 "*6-20": /^[^\s]{6,20}$/,
 "z2-4" : /^[\u4E00-\u9FA5\uf900-\ufa2d]{2,4}$/,
 "username":function(gets,obj,curform,regxp){
 //å‚æ•°getsæ˜¯è·å–åˆ°çš„è¡¨å•å…ƒç´ å€¼ï¼Œobjä¸ºå½“å‰è¡¨å•å…ƒç´ ï¼Œcurformä¸ºå½“å‰éªŒè¯çš„è¡¨å•ï¼Œregxpä¸ºå†…ç½®çš„ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼çš„å¼•ç”?;
 var reg1=/^[\w\.]{4,16}$/,
 reg2=/^[\u4E00-\u9FA5\uf900-\ufa2d]{2,8}$/;

 if(reg1.test(gets)){return true;}
 if(reg2.test(gets)){return true;}
 return false;

 //æ³¨æ„returnå¯ä»¥è¿”å›true æˆ? false æˆ? å­—ç¬¦ä¸²æ–‡å­—ï¼Œtrueè¡¨ç¤ºéªŒè¯é€šè¿‡ï¼Œè¿”å›å­—ç¬¦ä¸²è¡¨ç¤ºéªŒè¯å¤±è´¥ï¼Œå­—ç¬¦ä¸²ä½œä¸ºé”™è¯¯æç¤ºæ˜¾ç¤ºï¼Œè¿”å›falseåˆ™ç”¨errmsgæˆ–é»˜è®¤çš„é”™è¯¯æç¤º;
 },
 "phone":function(){
 // 5.0 ç‰ˆæœ¬ä¹‹åï¼Œè¦å®ç°äºŒé€‰ä¸€çš„éªŒè¯æ•ˆæœï¼Œdatatype çš„åç§? ä¸? éœ€è¦ä»¥ "option_" å¼€å¤?;
 }
 },
 usePlugin:{
 swfupload:{},
 datepicker:{},
 passwordstrength:{},
 jqtransform:{
 selector:"select,input"
 }
 },
 beforeCheck:function(curform){
 //åœ¨è¡¨å•æäº¤æ‰§è¡ŒéªŒè¯ä¹‹å‰æ‰§è¡Œçš„å‡½æ•°ï¼Œcurformå‚æ•°æ˜¯å½“å‰è¡¨å•å¯¹è±¡ã€?
 //è¿™é‡Œæ˜ç¡®return falseçš„è¯å°†ä¸ä¼šç»§ç»­æ‰§è¡ŒéªŒè¯æ“ä½?;
 },
 beforeSubmit:function(curform){
 //åœ¨éªŒè¯æˆåŠŸåï¼Œè¡¨å•æäº¤å‰æ‰§è¡Œçš„å‡½æ•°ï¼Œcurformå‚æ•°æ˜¯å½“å‰è¡¨å•å¯¹è±¡ã€?
 //è¿™é‡Œæ˜ç¡®return falseçš„è¯è¡¨å•å°†ä¸ä¼šæäº?;
 },
 callback:function(data){
 //è¿”å›æ•°æ®dataæ˜¯jsonæ ¼å¼ï¼Œ{"info":"demo info","status":"y"}
 //info: è¾“å‡ºæç¤ºä¿¡æ¯;
 //status: è¿”å›æäº¤æ•°æ®çš„çŠ¶æ€?,æ˜¯å¦æäº¤æˆåŠŸã€‚å¦‚å¯ä»¥ç”?"y"è¡¨ç¤ºæäº¤æˆåŠŸï¼?"n"è¡¨ç¤ºæäº¤å¤±è´¥ï¼Œåœ¨ajax_post.phpæ–‡ä»¶è¿”å›æ•°æ®é‡Œè‡ªå®šå­—ç¬¦ï¼Œä¸»è¦ç”¨åœ¨callbackå‡½æ•°é‡Œæ ¹æ®è¯¥å€¼æ‰§è¡Œç›¸åº”çš„å›è°ƒæ“ä½œ;
 //ä½ ä¹Ÿå¯ä»¥åœ¨ajax_post.phpæ–‡ä»¶è¿”å›æ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œè·å–ï¼Œè¿›è¡Œç›¸åº”æ“ä½œï¼?
 //ajaxé‡åˆ°æœåŠ¡ç«¯é”™è¯¯æ—¶ä¹Ÿä¼šæ‰§è¡Œå›è°ƒï¼Œè¿™æ—¶çš„dataæ˜¯{ status:**, statusText:**, readyState:**, responseText:** }ï¼?

 //è¿™é‡Œæ‰§è¡Œå›è°ƒæ“ä½œ;
 //æ³¨æ„ï¼šå¦‚æœä¸æ˜¯ajaxæ–¹å¼æäº¤è¡¨å•ï¼Œä¼ å…¥callbackï¼Œè¿™æ—¶dataå‚æ•°æ˜¯å½“å‰è¡¨å•å¯¹è±¡ï¼Œå›è°ƒå‡½æ•°ä¼šåœ¨è¡¨å•éªŒè¯å…¨éƒ¨é€šè¿‡åæ‰§è¡Œï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æäº¤è¡¨å•ï¼Œå¦‚æœcallbacké‡Œæ˜ç¡®return falseï¼Œåˆ™è¡¨å•ä¸ä¼šæäº¤ï¼Œå¦‚æœreturn trueæˆ–æ²¡æœ‰returnï¼Œåˆ™ä¼šæäº¤è¡¨å•ã€?
 }
 });

 Validformå¯¹è±¡çš„æ–¹æ³•å’Œå±æ€§ï¼š
 tipmsgï¼šè‡ªå®šä¹‰æç¤ºä¿¡æ¯ï¼Œé€šè¿‡ä¿®æ”¹Validformå¯¹è±¡çš„è¿™ä¸ªå±æ€§å€¼æ¥è®©åŒä¸€ä¸ªé¡µé¢çš„ä¸åŒè¡¨å•ä½¿ç”¨ä¸åŒçš„æç¤ºæ–‡å­—ï¼›
 dataTypeï¼šè·å–å†…ç½®çš„ä¸€äº›æ­£åˆ™ï¼›
 eq(n)ï¼šè·å–Validformå¯¹è±¡çš„ç¬¬nä¸ªå…ƒç´?;
 ajaxPost(flag,sync,url)ï¼šä»¥ajaxæ–¹å¼æäº¤è¡¨å•ã€‚flagä¸ºtrueæ—¶ï¼Œè·³è¿‡éªŒè¯ç›´æ¥æäº¤ï¼Œsyncä¸ºtrueæ—¶å°†ä»¥åŒæ­¥çš„æ–¹å¼è¿›è¡Œajaxæäº¤ï¼Œä¼ å…¥äº†urlåœ°å€æ—¶ï¼Œè¡¨å•ä¼šæäº¤åˆ°è¿™ä¸ªåœ°å€ï¼?
 abort()ï¼šç»ˆæ­¢ajaxçš„æäº¤ï¼›
 submitForm(flag,url)ï¼šä»¥å‚æ•°é‡Œè®¾ç½®çš„æ–¹å¼æäº¤è¡¨å•ï¼Œflagä¸ºtrueæ—¶ï¼Œè·³è¿‡éªŒè¯ç›´æ¥æäº¤ï¼Œä¼ å…¥äº†urlåœ°å€æ—¶ï¼Œè¡¨å•ä¼šæäº¤åˆ°è¿™ä¸ªåœ°å€ï¼?
 resetForm()ï¼šé‡ç½®è¡¨å•ï¼›
 resetStatus()ï¼šé‡ç½®è¡¨å•çš„æäº¤çŠ¶æ€ã€‚ä¼ å…¥äº†postonceå‚æ•°çš„è¯ï¼Œè¡¨å•æˆåŠŸæäº¤åçŠ¶æ€ä¼šè®¾ç½®ä¸?"posted"ï¼Œé‡ç½®æäº¤çŠ¶æ€å¯ä»¥è®©è¡¨å•ç»§ç»­å¯ä»¥æäº¤ï¼?
 getStatus()ï¼šè·å–è¡¨å•çš„æäº¤çŠ¶æ€ï¼Œnormalï¼šæœªæäº¤ï¼Œpostingï¼šæ­£åœ¨æäº¤ï¼Œpostedï¼šå·²æˆåŠŸæäº¤è¿‡ï¼›
 setStatus(status)ï¼šè®¾ç½®è¡¨å•çš„æäº¤çŠ¶æ€ï¼Œå¯ä»¥è®¾ç½®normalï¼Œpostingï¼Œpostedä¸‰ç§çŠ¶æ€ï¼Œä¸ä¼ å‚åˆ™è®¾ç½®çŠ¶æ€ä¸ºpostingï¼Œè¿™ä¸ªçŠ¶æ€è¡¨å•å¯ä»¥éªŒè¯ï¼Œä½†ä¸èƒ½æäº¤ï¼›
 ignore(selector)ï¼šå¿½ç•¥å¯¹æ‰€é€‰æ‹©å¯¹è±¡çš„éªŒè¯ï¼›
 unignore(selector)ï¼šå°†ignoreæ–¹æ³•æ‰€å¿½ç•¥éªŒè¯çš„å¯¹è±¡é‡æ–°è·å–éªŒè¯æ•ˆæœï¼›
 addRule(rule)ï¼šå¯ä»¥é€šè¿‡Validformå¯¹è±¡çš„è¿™ä¸ªæ–¹æ³•æ¥ç»™è¡¨å•å…ƒç´ ç»‘å®šéªŒè¯è§„åˆ™ï¼›
 check(bool,selector):å¯¹æŒ‡å®šå¯¹è±¡è¿›è¡ŒéªŒè¯?(é»˜è®¤éªŒè¯å½“å‰æ•´ä¸ªè¡¨å•)ï¼Œé€šè¿‡è¿”å›trueï¼Œå¦åˆ™è¿”å›falseï¼ˆç»‘å®šå®æ—¶éªŒè¯çš„å¯¹è±¡ï¼Œæ ¼å¼ç¬¦åˆè¦æ±‚æ—¶è¿”å›trueï¼Œè€Œä¸ä¼šç­‰ajaxçš„è¿”å›ç»“æœï¼‰ï¼Œboolä¸ºtrueæ—¶åˆ™åªéªŒè¯ä¸æ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼?
 config(setup):å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥æŒ‡å®šè¡¨å•çš„æäº¤åœ°å€ï¼Œç»™è¡¨å•ajaxå’Œå®æ—¶éªŒè¯çš„ajaxé‡Œè®¾ç½®å‚æ•°ï¼›
 */

(function ($, win, undef) {
    var errorobj = null,//æŒ‡ç¤ºå½“å‰éªŒè¯å¤±è´¥çš„è¡¨å•å…ƒç´?;
        msgobj = null,//pop box object
        msghidden = true;//msgbox hidden?

    var tipmsg = {//é»˜è®¤æç¤ºæ–‡å­—;
        tit: "æç¤ºä¿¡æ¯",
        w: {
            "*": "ä¸èƒ½ä¸ºç©ºï¼?",
            "*6-16": "è¯·å¡«å†?6åˆ?16ä½ä»»æ„å­—ç¬¦ï¼",
            "n": "è¯·å¡«å†™æ•´æ•°æ•°å­—ï¼",
            "n6-16": "è¯·å¡«å†?6åˆ?16ä½æ•´æ•°æ•°å­—ï¼",
            "s": "ä¸èƒ½è¾“å…¥ç‰¹æ®Šå­—ç¬¦ï¼?",
            "s6-18": "è¯·å¡«å†?6åˆ?18ä½å­—ç¬¦ï¼",
            "p": "è¯·å¡«å†™é‚®æ”¿ç¼–ç ï¼",
            "tel": "è¯·å¡«å†™æ­£ç¡®çš„å®¢æœç”µè¯!",
            "m": "è¯·å¡«å†™æ­£ç¡®çš„æ‰‹æœºå·ç ï¼?",
            "e": "è¯·å¡«å†™æ­£ç¡®çš„é‚®ç®±åœ°å€ï¼?",
            "url": "è¯·å¡«å†™æ­£ç¡®çš„ç½‘å€,æœ€é•?50ä½å­—ç¬¦ï¼",
            "cn": "åªèƒ½å¡«å†™ä¸­æ–‡",
            "float": "è¯·å¡«å†™æ­£ç¡®çš„æ•°å€?",
            "float_0": "è¯·å¡«å†™æ­£ç¡®çš„æ•°å€?",
            "float_03": "è¯·å¡«å†™æ­£ç¡®çš„æ•°å€?",
            "date": "æ—¶é—´æ ¼å¼ä¸æ­£ç¡?",
            "idnum": "è¯·å¡«å†™æ­£ç¡®çš„èº«ä»½è¯å·",
            "a": "è¯·å¡«å†™æ•°å­—æˆ–å­—æ¯ï¼?",
            "a6-16": "è¯·å¡«å†?6åˆ?16ä½æ•°å­—æˆ–å­—æ¯ï¼?"
        },
        def: "è¯·å¡«å†™æ­£ç¡®ä¿¡æ¯ï¼",
        undef: "datatypeæœªå®šä¹‰ï¼",
        reck: "ä¸¤æ¬¡è¾“å…¥çš„å†…å®¹ä¸ä¸€è‡´ï¼",
        //r: "é€šè¿‡ä¿¡æ¯éªŒè¯ï¼?",
        c: "æ­£åœ¨æ£€æµ‹ä¿¡æ¯â€?",
        s: "è¯·{å¡«å†™|é€‰æ‹©}{0|ä¿¡æ¯}ï¼?",
        v: "æ‰€å¡«ä¿¡æ¯æ²¡æœ‰ç»è¿‡éªŒè¯ï¼Œè¯·ç¨åâ€?",
        p: "æ­£åœ¨æäº¤æ•°æ®â€?"
    }
    $.Tipmsg = tipmsg;

    var Validform = function (forms, settings, inited) {
        var settings = $.extend({}, Validform.defaults, settings);
        settings.datatype && $.extend(Validform.util.dataType, settings.datatype);

        var brothers = this;
        brothers.tipmsg = {w: {}};
        brothers.settings = settings;
        brothers.forms = forms;
        brothers.objects = [];

        //åˆ›å»ºå­å¯¹è±¡æ—¶ä¸å†ç»‘å®šäº‹ä»¶;
        if (inited === true) {
            return false;
        }

        forms.each(function () {
            //å·²ç»ç»‘å®šäº‹ä»¶æ—¶è·³è¿‡ï¼Œé¿å…äº‹ä»¶é‡å¤ç»‘å®š;
            if (this.validform_inited == "inited") {
                return true;
            }
            this.validform_inited = "inited";

            var $this = $(this);

            //é˜²æ­¢è¡¨å•æŒ‰é’®åŒå‡»æäº¤ä¸¤æ¬¡;
            this.validform_status = "normal"; //normal | posting | posted;

            //labelï¼Œåœ¨æ²¡æœ‰è¾“å…¥æ—¶æŸ¥æ‰¾è¦æ˜¾ç¤ºçš„æç¤ºæ–‡å­?;
            this.validform_label = settings.label;

            //è®©æ¯ä¸ªValidformå¯¹è±¡éƒ½èƒ½è‡ªå®šä¹‰tipmsg;
            $this.data("tipmsg", brothers.tipmsg);

            //bind the blur event;
            $this.delegate("[datatype]", "blur", function () {
                //åˆ¤æ–­æ˜¯å¦æ˜¯åœ¨æäº¤è¡¨å•æ“ä½œæ—¶è§¦å‘çš„éªŒè¯è¯·æ±‚ï¼?
                var subpost = arguments[1];
                Validform.util.check.call(this, $this, brothers, subpost);
            });

            //ç‚¹å‡»è¡¨å•å…ƒç´ ï¼Œé»˜è®¤æ–‡å­—æ¶ˆå¤±æ•ˆæ?;
            //è¡¨å•å…ƒç´ å€¼æ¯”è¾ƒæ—¶çš„ä¿¡æ¯æç¤ºå¢å¼?;
            //radioã€checkboxæç¤ºä¿¡æ¯å¢å¼º;
            //å¤–è°ƒæ’ä»¶åˆå§‹åŒ?;
            Validform.util.enhance.call($this, settings.tiptype, settings.usePlugin, settings.tipSweep);

            settings.btnSubmit && $this.find(settings.btnSubmit).bind("click", function () {
                $this.trigger("submit");
                return false;
            });

            $this.submit(function () {
                var subflag = Validform.util.submitForm.call($this, settings);
                subflag === undef && (subflag = true);
                return subflag;
            });

            $this.find("[type='reset']").add($this.find(settings.btnReset)).bind("click", function () {
                Validform.util.resetForm.call($this);
            });

        });

        //é¢„åˆ›å»ºpop box;
        if (settings.tiptype == 1 || (settings.tiptype == 2 || settings.tiptype == 3) && settings.ajaxPost) {
            creatMsgbox();
        }
    }

    Validform.defaults = {
        tiptype: 1,
        tipSweep: false,
        showAllError: false,
        postonce: false,
        ajaxPost: false
    }

    Validform.util = {
        dataType: {
            "*": /[\w\W]+/,
            "*6-16": /^[\w\W]{6,16}$/,
            n: /^\d+$/,
            "n6-16": /^\d{6,16}$/,
            s: /^[\u4E00-\u9FA5\uf900-\ufa2d\w\.]+$/,
            "s6-18": /^[\u4E00-\u9FA5\uf900-\ufa2d\w\.]{6,18}$/,
            a: /^[A-Za-z0-9]+$/,
            "a6-16": /^[A-Za-z0-9]{6,16}$/,
            p: /^[0-9]{6}$/,
            tel: /^((\d{3,4}\-)|)\d{7,8}(|([-\u8f6c]{1}\d{1,5}))(|(\-\d{3,5}))$|(^1[3|4|5|6|7|8][0-9]{9}$)/,
            m: /^\d{11}$/,
            e: /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,
            url: /^(\w+:\/\/)?\w+(\.\w+)+.*$/,
            cn: /^[\u4E00-\u9FA5\uf900-\ufa2d]+$/,
            float: function (gets, obj, curform, regxp) {
                var regxp = /^\d{1,10}(\.\d{1,2})?$/;
                if (!regxp.test(gets) || parseFloat(gets) == 0) {
                    return false;
                }
            },
            float_0: /^\d{1,10}(\.\d{1,2})?$/,
            float_03: /^([1-9](\d{1,9})?(\.\d{1,3})?|\d{1,10}\.\d{1,3})$/,
            date: /^\d{4}-\d{2}-\d{2}(\s+\d{2}:\d{2})?$/,
            passport :/^1[45][0-9]{7}|[GEPSD][0-9]{6,7}(\([0-9]\)|[0-9])$|^[HM][0-9]{10}$/, //éªŒè¯æŠ¤ç…§è¯ä»¶å?
            idnum: function (gets, obj, curform, regxp) {
                idCard = gets;
                var regIdCard = /^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/;
                var result = true;
                //å¦‚æœé€šè¿‡è¯¥éªŒè¯ï¼Œè¯´æ˜èº«ä»½è¯æ ¼å¼æ­£ç¡®ï¼Œä½†å‡†ç¡®æ€§è¿˜éœ€è®¡ç®—
                if (/^((\s?[A-Za-z])|([A-Za-z]{1}))\d{6}([0-9aA]|\([0-9aA]\))$|^[a-zA-Z][1-2][0-9]{8}$|^[1|5|7][0-9]{6}\([0-9a-zA-Z]\)$/.test(idCard) == true) { //éªŒè¯é¦™æ¸¯/å°æ¹¾èº«ä»½è¯?/æ¾³é—¨
                    result = true;
                } else if (regIdCard.test(idCard)) {
                    if (idCard.length == 18) {
                        var idCardWi = new Array(7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2); //å°†å‰17ä½åŠ æƒå› å­ä¿å­˜åœ¨æ•°ç»„é‡?
                        var idCardY = new Array(1, 0, 10, 9, 8, 7, 6, 5, 4, 3, 2); //è¿™æ˜¯é™¤ä»¥11åï¼Œå¯èƒ½äº§ç”Ÿçš?11ä½ä½™æ•°ã€éªŒè¯ç ï¼Œä¹Ÿä¿å­˜æˆæ•°ç»?
                        var idCardWiSum = 0; //ç”¨æ¥ä¿å­˜å‰?17ä½å„è‡ªä¹–ä»¥åŠ æƒå› å­åçš„æ€»å’Œ
                        for (var i = 0; i < 17; i++) {
                            idCardWiSum += idCard.substring(i, i + 1) * idCardWi[i];
                        }
                        var idCardMod = idCardWiSum % 11; //è®¡ç®—å‡ºæ ¡éªŒç æ‰€åœ¨æ•°ç»„çš„ä½ç½®
                        var idCardLast = idCard.substring(17); //å¾—åˆ°æœ€åä¸€ä½èº«ä»½è¯å·ç 
                        //å¦‚æœç­‰äº2ï¼Œåˆ™è¯´æ˜æ ¡éªŒç æ˜¯10ï¼Œèº«ä»½è¯å·ç æœ€åä¸€ä½åº”è¯¥æ˜¯X
                        if (idCardMod == 2) {
                            if (idCardLast == "X" || idCardLast == "x") {
                                result = true;
                            } else {
                                result = false;
                            }
                        } else {
                            //ç”¨è®¡ç®—å‡ºçš„éªŒè¯ç ä¸æœ€åä¸€ä½èº«ä»½è¯å·ç åŒ¹é…ï¼Œå¦‚æœä¸€è‡´ï¼Œè¯´æ˜é€šè¿‡ï¼Œå¦åˆ™æ˜¯æ— æ•ˆçš„èº«ä»½è¯å·ç 
                            if (idCardLast == idCardY[idCardMod]) {
                                result = true;
                            } else {
                                result = false;
                            }
                        }
                    }
                } else {
                    result = false;
                }
                return result;
            }
        },

        toString: Object.prototype.toString,

        isEmpty: function (val) {
            return val === "" || val === $.trim(this.attr("tip"));
        },

        getValue: function (obj) {
            var inputval,
                curform = this;

            if (obj.is(":radio")) {
                inputval = curform.find(":radio[name='" + obj.attr("name") + "']:checked").val();
                inputval = inputval === undef ? "" : inputval;
            } else if (obj.is(":checkbox")) {
                inputval = "";
                curform.find(":checkbox[name='" + obj.attr("name") + "']:checked").each(function () {
                    inputval += $(this).val() + ',';
                })
                inputval = inputval === undef ? "" : inputval;
            } else {
                inputval = obj.val();
            }
            inputval = $.trim(inputval);

            return Validform.util.isEmpty.call(obj, inputval) ? "" : inputval;
        },

        enhance: function (tiptype, usePlugin, tipSweep, addRule) {
            var curform = this;

            //é¡µé¢ä¸Šä¸å­˜åœ¨æç¤ºä¿¡æ¯çš„æ ‡ç­¾æ—¶ï¼Œè‡ªåŠ¨åˆ›å»?;
            curform.find("[datatype]").each(function () {
                if (tiptype == 2) {
                    if ($(this).parent().next().find(".Validform_checktip").length == 0) {
                        $(this).parent().next().append("<span class='Validform_checktip' />");
                    }
                } else if (tiptype == 3 || tiptype == 4) {
                    if ($(this).siblings(".Validform_checktip").length == 0) {
                        $(this).parent().append("<span class='Validform_checktip' />");
                    }
                }
                var regxp = /^(.+?)((\d+)-(\d+))$/;
                var _datatype = $(this).attr('datatype');
                if (regxp.test(_datatype)) {
                    var mac = _datatype.match(regxp);
                    $(this).attr('minlength', mac[3]);
                    $(this).attr('maxlength', mac[4]);
                }

            })

            //è¡¨å•å…ƒç´ å€¼æ¯”è¾ƒæ—¶çš„ä¿¡æ¯æç¤ºå¢å¼?;
            curform.find("input[recheck]").each(function () {
                //å·²ç»ç»‘å®šäº‹ä»¶æ—¶è·³è¿?;
                if (this.validform_inited == "inited") {
                    return true;
                }
                this.validform_inited = "inited";

                var _this = $(this);
                var recheckinput = curform.find("input[name='" + $(this).attr("recheck") + "']");
                recheckinput.bind("keyup", function () {
                    if (recheckinput.val() == _this.val() && recheckinput.val() != "") {
                        if (recheckinput.attr("tip")) {
                            if (recheckinput.attr("tip") == recheckinput.val()) {
                                return false;
                            }
                        }
                        _this.trigger("blur");
                    }
                }).bind("blur", function () {
                    if (recheckinput.val() != _this.val() && _this.val() != "") {
                        if (_this.attr("tip")) {
                            if (_this.attr("tip") == _this.val()) {
                                return false;
                            }
                        }
                        _this.trigger("blur");
                    }
                });
            });

            //hasDefaultText;
            curform.find("[tip]").each(function () {//tipæ˜¯è¡¨å•å…ƒç´ çš„é»˜è®¤æç¤ºä¿¡æ¯,è¿™æ˜¯ç‚¹å‡»æ¸…ç©ºæ•ˆæœ;
                //å·²ç»ç»‘å®šäº‹ä»¶æ—¶è·³è¿?;
                if (this.validform_inited == "inited") {
                    return true;
                }
                this.validform_inited = "inited";

                var defaultvalue = $(this).attr("tip");
                var altercss = $(this).attr("altercss");
                $(this).focus(function () {
                    if ($(this).val() == defaultvalue) {
                        $(this).val('');
                        if (altercss) {
                            $(this).removeClass(altercss);
                        }
                    }
                }).blur(function () {
                    if ($.trim($(this).val()) === '') {
                        $(this).val(defaultvalue);
                        if (altercss) {
                            $(this).addClass(altercss);
                        }
                    }
                });
            });

            //enhance info feedback for checkbox & radio;
            curform.find(":checkbox[datatype],:radio[datatype]").each(function () {
                //å·²ç»ç»‘å®šäº‹ä»¶æ—¶è·³è¿?;
                if (this.validform_inited == "inited") {
                    return true;
                }
                this.validform_inited = "inited";

                var _this = $(this);
                var name = _this.attr("name");
                curform.find("[name='" + name + "']").filter(":checkbox,:radio").bind("click", function () {
                    //é¿å…å¤šä¸ªäº‹ä»¶ç»‘å®šæ—¶çš„å–å€¼æ»åé—®é¢?;
                    setTimeout(function () {
                        _this.trigger("blur");
                    }, 0);
                });

            });

            //select multiple;
            curform.find("select[datatype][multiple]").bind("click", function () {
                var _this = $(this);
                setTimeout(function () {
                    _this.trigger("blur");
                }, 0);
            });

            //plugins here to start;
            Validform.util.usePlugin.call(curform, usePlugin, tiptype, tipSweep, addRule);
        },

        usePlugin: function (plugin, tiptype, tipSweep, addRule) {
            /*
             plugin:settings.usePlugin;
             tiptype:settings.tiptype;
             tipSweep:settings.tipSweep;
             addRule:æ˜¯å¦åœ¨addRuleæ—¶è§¦å?;
             */

            var curform = this,
                plugin = plugin || {};
            //swfupload;
            if (curform.find("input[plugin='swfupload']").length && typeof(swfuploadhandler) != "undefined") {

                var custom = {
                    custom_settings: {
                        form: curform,
                        showmsg: function (msg, type, obj) {
                            Validform.util.showmsg.call(curform, msg, tiptype, {obj: curform.find("input[plugin='swfupload']"), type: type, sweep: tipSweep});
                        }
                    }
                };

                custom = $.extend(true, {}, plugin.swfupload, custom);

                curform.find("input[plugin='swfupload']").each(function (n) {
                    if (this.validform_inited == "inited") {
                        return true;
                    }
                    this.validform_inited = "inited";

                    $(this).val("");
                    swfuploadhandler.init(custom, n);
                });

            }

            //datepicker;
            if (curform.find("input[plugin='datepicker']").length && $.fn.datePicker) {
                plugin.datepicker = plugin.datepicker || {};

                if (plugin.datepicker.format) {
                    Date.format = plugin.datepicker.format;
                    delete plugin.datepicker.format;
                }
                if (plugin.datepicker.firstDayOfWeek) {
                    Date.firstDayOfWeek = plugin.datepicker.firstDayOfWeek;
                    delete plugin.datepicker.firstDayOfWeek;
                }

                curform.find("input[plugin='datepicker']").each(function (n) {
                    if (this.validform_inited == "inited") {
                        return true;
                    }
                    this.validform_inited = "inited";

                    plugin.datepicker.callback && $(this).bind("dateSelected", function () {
                        var d = new Date($.event._dpCache[this._dpId].getSelected()[0]).asString(Date.format);
                        plugin.datepicker.callback(d, this);
                    });
                    $(this).datePicker(plugin.datepicker);
                });
            }

            //passwordstrength;
            if (curform.find("input[plugin*='passwordStrength']").length && $.fn.passwordStrength) {
                plugin.passwordstrength = plugin.passwordstrength || {};
                plugin.passwordstrength.showmsg = function (obj, msg, type) {
                    Validform.util.showmsg.call(curform, msg, tiptype, {obj: obj, type: type, sweep: tipSweep});
                };

                curform.find("input[plugin='passwordStrength']").each(function (n) {
                    if (this.validform_inited == "inited") {
                        return true;
                    }
                    this.validform_inited = "inited";

                    $(this).passwordStrength(plugin.passwordstrength);
                });
            }

            //jqtransform;
            if (addRule != "addRule" && plugin.jqtransform && $.fn.jqTransSelect) {
                var jqTransformHideSelect = function (oTarget) {
                    var ulVisible = $('.jqTransformSelectWrapper ul:visible');
                    ulVisible.each(function () {
                        var oSelect = $(this).parents(".jqTransformSelectWrapper:first").find("select").get(0);
                        //do not hide if click on the label object associated to the select
                        if (!(oTarget && oSelect.oLabel && oSelect.oLabel.get(0) == oTarget.get(0))) {
                            $(this).hide();
                        }
                    });
                };

                /* Check for an external click */
                var jqTransformCheckExternalClick = function (event) {
                    if ($(event.target).parents('.jqTransformSelectWrapper').length === 0) {
                        jqTransformHideSelect($(event.target));
                    }
                };

                var jqTransformAddDocumentListener = function () {
                    $(document).mousedown(jqTransformCheckExternalClick);
                };

                if (plugin.jqtransform.selector) {
                    curform.find(plugin.jqtransform.selector).filter('input:submit, input:reset, input[type="button"]').jqTransInputButton();
                    curform.find(plugin.jqtransform.selector).filter('input:text, input:password').jqTransInputText();
                    curform.find(plugin.jqtransform.selector).filter('input:checkbox').jqTransCheckBox();
                    curform.find(plugin.jqtransform.selector).filter('input:radio').jqTransRadio();
                    curform.find(plugin.jqtransform.selector).filter('textarea').jqTransTextarea();
                    if (curform.find(plugin.jqtransform.selector).filter("select").length > 0) {
                        curform.find(plugin.jqtransform.selector).filter("select").jqTransSelect();
                        jqTransformAddDocumentListener();
                    }

                } else {
                    curform.jqTransform();
                }

                curform.find(".jqTransformSelectWrapper").find("li a").click(function () {
                    $(this).parents(".jqTransformSelectWrapper").find("select").trigger("blur");
                });
            }

        },

        getNullmsg: function (curform) {
            var obj = this;
            var reg = /[\u4E00-\u9FA5\uf900-\ufa2da-zA-Z\s]+/g;
            var nullmsg;

            var label = curform[0].validform_label || ".Validform_label";
            label = obj.siblings(label).text() || obj.siblings().find(label).text() || obj.parent().siblings(label).text() || obj.parent().siblings().find(label).text();
            label = label.match(reg) || [""];

            reg = /\{(.+)\|(.+)\}/;
            nullmsg = curform.data("tipmsg").s || tipmsg.s;
            label = label[0].replace(/\s(?![a-zA-Z])/g, "");

            if (label != "") {
                nullmsg = nullmsg.replace(/\{0\|(.+)\}/, label);
                if (obj.attr("recheck")) {
                    nullmsg = nullmsg.replace(/\{(.+)\}/, "");
                    obj.attr("nullmsg", nullmsg);
                    return nullmsg;
                }
            } else {
                nullmsg = obj.is(":checkbox,:radio,select") ? nullmsg.replace(/\{0\|(.+)\}/, "") : nullmsg.replace(/\{0\|(.+)\}/, "$1");
            }
            nullmsg = obj.is(":checkbox,:radio,select") ? nullmsg.replace(reg, "$2") : nullmsg.replace(reg, "$1");

            obj.attr("nullmsg", nullmsg);
            return nullmsg;
        },

        getErrormsg: function (curform, datatype, recheck) {
            var obj = this;
            var regxp = /^(.+?)((\d+)-(\d+))?$/,
                regxp2 = /^(.+?)(\d+)-(\d+)$/,
                regxp3 = /(.*?)\d+(.+?)\d+(.*)/,
                mac = datatype.match(regxp),
                temp, str;

            //å¦‚æœæ˜¯å€¼ä¸ä¸€æ ·è€ŒæŠ¥é”?;
            if (recheck == "recheck") {
                str = curform.data("tipmsg").reck || tipmsg.reck;
                return str;
            }

            //å¦‚æœåŸæ¥å°±æœ‰ï¼Œç›´æ¥æ˜¾ç¤ºè¯¥é¡¹çš„æç¤ºä¿¡æ¯;
            if (mac[0] in tipmsg.w) {
                return curform.data("tipmsg").w[mac[0]] || tipmsg.w[mac[0]];
            }

            //æ²¡æœ‰çš„è¯åœ¨æç¤ºå¯¹è±¡é‡ŒæŸ¥æ‰¾ç›¸ä¼¼;
            for (var name in tipmsg.w) {
                if (name.indexOf(mac[1]) != -1 && regxp2.test(name)) {
                    str = (curform.data("tipmsg").w[name] || tipmsg.w[name]).replace(regxp3, "$1" + mac[3] + "$2" + mac[4] + "$3");
                    tipmsg.w[mac[0]] = str;

                    return str;
                }

            }

            return curform.data("tipmsg").def || tipmsg.def;
        },

        _regcheck: function (datatype, gets, obj, curform) {
            var curform = curform,
                info = null,
                passed = false,
                reg = /\/.+\//g,
                regex = /^(.+?)(\d+)-(\d+)$/,
                type = 3;//default set to wrong type, 2,3,4;

            //datatypeæœ‰ä¸‰ç§æƒ…å†µï¼šæ­£åˆ™ï¼Œå‡½æ•°å’Œç›´æ¥ç»‘å®šçš„æ­£åˆ?;

            //ç›´æ¥æ˜¯æ­£åˆ?;
            if (reg.test(datatype)) {
                var regstr = datatype.match(reg)[0].slice(1, -1);
                var param = datatype.replace(reg, "");
                var rexp = RegExp(regstr, param);

                passed = rexp.test(gets);

                //function;
            } else if (Validform.util.toString.call(Validform.util.dataType[datatype]) == "[object Function]") {
                passed = Validform.util.dataType[datatype](gets, obj, curform, Validform.util.dataType);
                if (passed === true || passed === undef) {
                    passed = true;
                } else {
                    info = passed;
                    passed = false;
                }

                //è‡ªå®šä¹‰æ­£åˆ?;
            } else {
                //è‡ªåŠ¨æ‰©å±•datatype;
                if (!(datatype in Validform.util.dataType)) {
                    var mac = datatype.match(regex),
                        temp;

                    if (!mac) {
                        passed = false;
                        info = curform.data("tipmsg").undef || tipmsg.undef;
                    } else {
                        for (var name in Validform.util.dataType) {
                            temp = name.match(regex);
                            if (!temp) {
                                continue;
                            }
                            if (mac[1] === temp[1]) {
                                var str = Validform.util.dataType[name].toString(),
                                    param = str.match(/\/[mgi]*/g)[1].replace("\/", ""),
                                    regxp = new RegExp("\\{" + temp[2] + "," + temp[3] + "\\}", "g");
                                str = str.replace(/\/[mgi]*/g, "\/").replace(regxp, "{" + mac[2] + "," + mac[3] + "}").replace(/^\//, "").replace(/\/$/, "");
                                Validform.util.dataType[datatype] = new RegExp(str, param);
                                break;
                            }
                        }
                    }
                }

                if (Validform.util.toString.call(Validform.util.dataType[datatype]) == "[object RegExp]") {
                    passed = Validform.util.dataType[datatype].test(gets);
                }

            }


            if (passed) {
                type = 2;
                info = obj.attr("sucmsg") || curform.data("tipmsg").r || tipmsg.r;

                //è§„åˆ™éªŒè¯é€šè¿‡åï¼Œè¿˜éœ€è¦å¯¹ç»‘å®šrecheckçš„å¯¹è±¡è¿›è¡Œå€¼æ¯”è¾?;
                if (obj.attr("recheck")) {
                    var theother = curform.find("input[name='" + obj.attr("recheck") + "']:first");
                    if (gets != theother.val()) {
                        passed = false;
                        type = 3;
                        info = obj.attr("errormsg") || Validform.util.getErrormsg.call(obj, curform, datatype, "recheck");
                    }
                }
            } else {
                info = info || obj.attr("errormsg") || Validform.util.getErrormsg.call(obj, curform, datatype);

                //éªŒè¯ä¸é€šè¿‡ä¸”ä¸ºç©ºæ—¶;
                if (Validform.util.isEmpty.call(obj, gets)) {
                    info = obj.attr("nullmsg") || Validform.util.getNullmsg.call(obj, curform);
                }
            }

            return {
                passed: passed,
                type: type,
                info: info
            };

        },

        regcheck: function (datatype, gets, obj) {
            /*
             datatype:datatype;
             gets:inputvalue;
             obj:input object;
             */
            var curform = this,
                info = null,
                passed = false,
                type = 3;//default set to wrong type, 2,3,4;

            //ignore;
            if (obj.attr("ignore") === "ignore" && Validform.util.isEmpty.call(obj, gets)) {
                if (obj.data("cked")) {
                    info = "";
                }

                return {
                    passed: true,
                    type: 4,
                    info: info
                };
            }

            obj.data("cked", "cked");//do nothing if is the first time validation triggered;

            var dtype = Validform.util.parseDatatype(datatype);
            var res;
            for (var eithor = 0; eithor < dtype.length; eithor++) {
                for (var dtp = 0; dtp < dtype[eithor].length; dtp++) {
                    res = Validform.util._regcheck(dtype[eithor][dtp], gets, obj, curform);
                    if (!res.passed) {
                        break;
                    }
                }
                if (res.passed) {
                    break;
                }
            }
            return res;

        },

        parseDatatype: function (datatype) {
            /*
             å­—ç¬¦ä¸²é‡Œé¢åªèƒ½å«æœ‰ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼;
             Datatypeåç§°å¿…é¡»æ˜¯å­—æ¯ï¼Œæ•°å­—ã€ä¸‹åˆ’çº¿æˆ?*å·ç»„æˆ?;
             datatype="/regexp/|phone|tel,s,e|f,e";
             ==>[["/regexp/"],["phone"],["tel","s","e"],["f","e"]];
             */

            var reg = /\/.+?\/[mgi]*(?=(,|$|\||\s))|[\w\*-]+/g,
                dtype = datatype.match(reg),
                sepor = datatype.replace(reg, "").replace(/\s*/g, "").split(""),
                arr = [],
                m = 0;

            arr[0] = [];
            arr[0].push(dtype[0]);
            for (var n = 0; n < sepor.length; n++) {
                if (sepor[n] == "|") {
                    m++;
                    arr[m] = [];
                }
                arr[m].push(dtype[n + 1]);
            }

            return arr;
        },

        showmsg: function (msg, type, o, triggered) {
            /*
             msg:æç¤ºæ–‡å­—;
             type:æç¤ºä¿¡æ¯æ˜¾ç¤ºæ–¹å¼;
             o:{obj:å½“å‰å¯¹è±¡, type:1=>æ­£åœ¨æ£€æµ? | 2=>é€šè¿‡, sweep:true | false},
             triggered:åœ¨bluræˆ–æäº¤è¡¨å•è§¦å‘çš„éªŒè¯ä¸­ï¼Œæœ‰äº›æƒ…å†µä¸éœ€è¦æ˜¾ç¤ºæç¤ºæ–‡å­—ï¼Œå¦‚è‡ªå®šä¹‰å¼¹å‡ºæç¤ºæ¡†çš„æ˜¾ç¤ºæ–¹å¼ï¼Œä¸éœ€è¦æ¯æ¬¡bluræ—¶å°±é©¬ä¸Šå¼¹å‡ºæç¤º;

             tiptype:1\2\3æ—¶éƒ½æœ‰å‘èƒ½ä¼šå¼¹å‡ºè‡ªå®šä¹‰æç¤ºæ¡†
             tiptype:1æ—¶åœ¨triggered bycheckæ—¶ä¸å¼¹æ¡†
             tiptype:2\3æ—¶åœ¨ajaxæ—¶å¼¹æ¡?
             tipSweepä¸ºtrueæ—¶åœ¨triggered bycheckæ—¶ä¸è§¦å‘showmsgï¼Œä½†ajaxå‡ºé”™çš„æƒ…å†µä¸‹è¦æç¤?
             */

            //å¦‚æœmsgä¸ºundefinedï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦æ‰§è¡Œåé¢çš„æ“ä½œï¼Œignoreæœ‰å¯èƒ½ä¼šå‡ºç°è¿™æƒ…å†?;
            if (msg == undef) {
                return;
            }

            //tipSweepä¸ºtrueï¼Œä¸”å½“å‰ä¸æ˜¯å¤„äºé”™è¯¯çŠ¶æ€æ—¶ï¼Œbluräº‹ä»¶ä¸è§¦å‘ä¿¡æ¯æ˜¾ç¤?;
            if (triggered == "bycheck" && o.sweep && (o.obj && !o.obj.is(".Validform_error") || typeof type == "function")) {
                return;
            }

            $.extend(o, {curform: this});

            if (typeof type == "function") {
                type(msg, o, Validform.util.cssctl);
                return;
            }

            if (type == 1 || triggered == "byajax" && type != 4) {
                msgobj.find(".Validform_info").html(msg);
            }

            //tiptypt=1æ—¶ï¼Œblurè§¦å‘showmsgï¼ŒéªŒè¯æ˜¯å¦é€šè¿‡éƒ½ä¸å¼¹æ¡†ï¼Œæäº¤è¡¨å•è§¦å‘çš„è¯ï¼Œåªè¦éªŒè¯å‡ºé”™ï¼Œå°±å¼¹æ¡†;
            if (type == 1 && triggered != "bycheck" && o.type != 2 || triggered == "byajax" && type != 4) {
                msghidden = false;
                msgobj.find(".iframe").css("height", msgobj.outerHeight());
                msgobj.show();
                setCenter(msgobj, 100);
            }

            if (type == 2 && o.obj) {
                o.obj.parent().next().find(".Validform_checktip").html(msg);
                Validform.util.cssctl(o.obj.parent().next().find(".Validform_checktip"), o.type);
            }

            if ((type == 3 || type == 4) && o.obj) {
                o.obj.siblings(".Validform_checktip").html(msg);
                Validform.util.cssctl(o.obj.siblings(".Validform_checktip"), o.type);
            }

        },

        cssctl: function (obj, status) {
            switch (status) {
                case 1:
                    obj.removeClass("Validform_right Validform_wrong").addClass("Validform_checktip Validform_loading");//checking;
                    break;
                case 2:
                    obj.removeClass("Validform_wrong Validform_loading").addClass("Validform_checktip Validform_right");//passed;
                    break;
                case 4:
                    obj.removeClass("Validform_right Validform_wrong Validform_loading").addClass("Validform_checktip");//for ignore;
                    break;
                default:
                    obj.removeClass("Validform_right Validform_loading").addClass("Validform_checktip Validform_wrong");//wrong;
            }
        },

        check: function (curform, brothers, subpost, bool) {
            /*
             æ£€æµ‹å•ä¸ªè¡¨å•å…ƒç´?;
             éªŒè¯é€šè¿‡è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€å®æ—¶éªŒè¯è¿”å›å€¼ä¸ºajax;
             boolï¼Œä¼ å…¥trueåˆ™åªæ£€æµ‹ä¸æ˜¾ç¤ºæç¤ºä¿¡æ¯;
             */
            var settings = brothers.settings;
            var subpost = subpost || "";
            var inputval = Validform.util.getValue.call(curform, $(this));

            //éšè—æˆ–ç»‘å®šdataIgnoreçš„è¡¨å•å¯¹è±¡ä¸åšéªŒè¯?;
            if (settings.ignoreHidden && $(this).is(":hidden") || $(this).data("dataIgnore") === "dataIgnore") {
                return true;
            }

            //dragonfly=trueæ—¶ï¼Œæ²¡æœ‰ç»‘å®šignoreï¼Œå€¼ä¸ºç©ºä¸åšéªŒè¯ï¼Œä½†éªŒè¯ä¸é€šè¿‡;
            if (settings.dragonfly && !$(this).data("cked") && Validform.util.isEmpty.call($(this), inputval) && $(this).attr("ignore") != "ignore") {
                return false;
            }

            var flag = Validform.util.regcheck.call(curform, $(this).attr("datatype"), inputval, $(this));

            //å€¼æ²¡å˜åŒ–ä¸åšæ£€æµ‹ï¼Œè¿™æ—¶è¦è€ƒè™‘recheckæƒ…å†µ;
            //ä¸æ˜¯åœ¨æäº¤è¡¨å•æ—¶è§¦å‘çš„ajaxéªŒè¯;
            if (inputval == this.validform_lastval && !$(this).attr("recheck") && subpost == "") {
                return flag.passed ? true : false;
            }

            this.validform_lastval = inputval;//å­˜å‚¨å½“å‰å€?;

            var _this;
            errorobj = _this = $(this);

            if (!flag.passed) {
                //å–æ¶ˆæ­£åœ¨è¿›è¡Œçš„ajaxéªŒè¯;
                Validform.util.abort.call(_this[0]);

                if (!bool) {
                    //ä¼ å…¥"bycheck"ï¼ŒæŒ‡ç¤ºå½“å‰æ˜¯checkæ–¹æ³•é‡Œè°ƒç”¨çš„ï¼Œå½“tiptype=1æ—¶ï¼Œbluräº‹ä»¶ä¸è®©è§¦å‘é”™è¯¯ä¿¡æ¯æ˜¾ç¤º;
                    Validform.util.showmsg.call(curform, flag.info, settings.tiptype, {obj: $(this), type: flag.type, sweep: settings.tipSweep}, "bycheck");

                    !settings.tipSweep && _this.addClass("Validform_error");
                }
                return false;
            }

            //éªŒè¯é€šè¿‡çš„è¯ï¼Œå¦‚æœç»‘å®šæœ‰ajaxurlï¼Œè¦æ‰§è¡Œajaxæ£€æµ?;
            //å½“ignore="ignore"æ—¶ï¼Œä¸ºç©ºå€¼å¯ä»¥é€šè¿‡éªŒè¯ï¼Œè¿™æ—¶ä¸éœ€è¦ajaxæ£€æµ?;
            var ajaxurl = $(this).attr("ajaxurl");
            if (ajaxurl && !Validform.util.isEmpty.call($(this), inputval) && !bool) {
                var inputobj = $(this);

                //å½“æäº¤è¡¨å•æ—¶ï¼Œè¡¨å•ä¸­çš„æŸé¡¹å·²ç»åœ¨æ‰§è¡Œajaxæ£€æµ‹ï¼Œè¿™æ—¶éœ€è¦è®©è¯¥é¡¹ajaxç»“æŸåç»§ç»­æäº¤è¡¨å?;
                if (subpost == "postform") {
                    inputobj[0].validform_subpost = "postform";
                } else {
                    inputobj[0].validform_subpost = "";
                }

                if (inputobj[0].validform_valid === "posting" && inputval == inputobj[0].validform_ckvalue) {
                    return "ajax";
                }

                inputobj[0].validform_valid = "posting";
                inputobj[0].validform_ckvalue = inputval;
                Validform.util.showmsg.call(curform, brothers.tipmsg.c || tipmsg.c, settings.tiptype, {obj: inputobj, type: 1, sweep: settings.tipSweep}, "bycheck");

                Validform.util.abort.call(_this[0]);

                var ajaxsetup = curform[0].validform_config || {};
                ajaxsetup = ajaxsetup.ajaxurl || {};

                var localconfig = {
                    type: "POST",
                    cache: false,
                    url: ajaxurl,
                    data: "param=" + encodeURIComponent(inputval) + "&name=" + encodeURIComponent($(this).attr("name")),
                    success: function (data) {
                        if ($.trim(data.status) === "y") {
                            inputobj[0].validform_valid = "true";
                            data.info && inputobj.attr("sucmsg", data.info);
                            Validform.util.showmsg.call(curform, inputobj.attr("sucmsg") || brothers.tipmsg.r || tipmsg.r, settings.tiptype, {
                                obj: inputobj,
                                type: 2,
                                sweep: settings.tipSweep
                            }, "bycheck");
                            _this.removeClass("Validform_error");
                            errorobj = null;
                            if (inputobj[0].validform_subpost == "postform") {
                                curform.trigger("submit");
                            }
                        } else {
                            inputobj[0].validform_valid = data.info;
                            Validform.util.showmsg.call(curform, data.info, settings.tiptype, {obj: inputobj, type: 3, sweep: settings.tipSweep});
                            _this.addClass("Validform_error");
                        }
                        _this[0].validform_ajax = null;
                    },
                    error: function (data) {
                        if (data.status == "200") {
                            if (data.responseText == "y") {
                                ajaxsetup.success({"status": "y"});
                            } else {
                                ajaxsetup.success({"status": "n", "info": data.responseText});
                            }
                            return false;
                        }

                        //æ­£åœ¨æ£€æµ‹æ—¶ï¼Œè¦æ£€æµ‹çš„æ•°æ®å‘ç”Ÿæ”¹å˜ï¼Œè¿™æ—¶è¦ç»ˆæ­¢å½“å‰çš„ajaxã€‚ä¸æ˜¯è¿™ç§æƒ…å†µå¼•èµ·çš„ajaxé”™è¯¯ï¼Œé‚£ä¹ˆæ˜¾ç¤ºç›¸å…³é”™è¯¯ä¿¡æ?;
                        if (data.statusText !== "abort") {
                            var msg = "status: " + data.status + "; statusText: " + data.statusText;

                            Validform.util.showmsg.call(curform, msg, settings.tiptype, {obj: inputobj, type: 3, sweep: settings.tipSweep});
                            _this.addClass("Validform_error");
                        }

                        inputobj[0].validform_valid = data.statusText;
                        _this[0].validform_ajax = null;

                        //localconfig.errorè¿”å›trueè¡¨ç¤ºè¿˜éœ€è¦æ‰§è¡Œtemp_err;
                        return true;
                    }
                }

                if (ajaxsetup.success) {
                    var temp_suc = ajaxsetup.success;
                    ajaxsetup.success = function (data) {
                        localconfig.success(data);
                        temp_suc(data, inputobj);
                    }
                }

                if (ajaxsetup.error) {
                    var temp_err = ajaxsetup.error;
                    ajaxsetup.error = function (data) {
                        //localconfig.errorè¿”å›falseè¡¨ç¤ºä¸éœ€è¦æ‰§è¡Œtemp_err;
                        localconfig.error(data) && temp_err(data, inputobj);
                    }
                }

                ajaxsetup = $.extend({}, localconfig, ajaxsetup, {dataType: "json"});
                _this[0].validform_ajax = $.ajax(ajaxsetup);

                return "ajax";
            } else if (ajaxurl && Validform.util.isEmpty.call($(this), inputval)) {
                Validform.util.abort.call(_this[0]);
                _this[0].validform_valid = "true";
            }

            if (!bool) {
                Validform.util.showmsg.call(curform, flag.info, settings.tiptype, {obj: $(this), type: flag.type, sweep: settings.tipSweep}, "bycheck");
                _this.removeClass("Validform_error");
            }
            errorobj = null;

            return true;

        },

        submitForm: function (settings, flg, url, ajaxPost, sync) {
            /*
             flg===trueæ—¶è·³è¿‡éªŒè¯ç›´æ¥æäº?;
             ajaxPost==="ajaxPost"æŒ‡ç¤ºå½“å‰è¡¨å•ä»¥ajaxæ–¹å¼æäº¤;
             */
            var curform = this;

            //è¡¨å•æ­£åœ¨æäº¤æ—¶ç‚¹å‡»æäº¤æŒ‰é’®ä¸åšååº?;
            if (curform[0].validform_status === "posting") {
                return false;
            }

            //è¦æ±‚åªèƒ½æäº¤ä¸€æ¬¡æ—¶;
            if (settings.postonce && curform[0].validform_status === "posted") {
                return false;
            }

            var beforeCheck = settings.beforeCheck && settings.beforeCheck(curform);
            if (beforeCheck === false) {
                return false;
            }

            var flag = true,
                inflag;

            curform.find("[datatype]").each(function () {
                //è·³è¿‡éªŒè¯;
                if (flg) {
                    return false;
                }

                //éšè—æˆ–ç»‘å®šdataIgnoreçš„è¡¨å•å¯¹è±¡ä¸åšéªŒè¯?;
                if (settings.ignoreHidden && $(this).is(":hidden") || $(this).data("dataIgnore") === "dataIgnore") {
                    return true;
                }

                var inputval = Validform.util.getValue.call(curform, $(this)),
                    _this;
                errorobj = _this = $(this);

                inflag = Validform.util.regcheck.call(curform, $(this).attr("datatype"), inputval, $(this));

                if (!inflag.passed) {
                    Validform.util.showmsg.call(curform, inflag.info, settings.tiptype, {obj: $(this), type: inflag.type, sweep: settings.tipSweep});
                    _this.addClass("Validform_error");

                    if (!settings.showAllError) {
                        _this.focus();
                        flag = false;
                        return false;
                    }

                    flag && (flag = false);
                    return true;
                }

                //å½“ignore="ignore"æ—¶ï¼Œä¸ºç©ºå€¼å¯ä»¥é€šè¿‡éªŒè¯ï¼Œè¿™æ—¶ä¸éœ€è¦ajaxæ£€æµ?;
                if ($(this).attr("ajaxurl") && !Validform.util.isEmpty.call($(this), inputval)) {
                    if (this.validform_valid !== "true") {
                        var thisobj = $(this);
                        Validform.util.showmsg.call(curform, curform.data("tipmsg").v || tipmsg.v, settings.tiptype, {obj: thisobj, type: 3, sweep: settings.tipSweep});
                        _this.addClass("Validform_error");

                        thisobj.trigger("blur", ["postform"]);//continue the form post;

                        if (!settings.showAllError) {
                            flag = false;
                            return false;
                        }

                        flag && (flag = false);
                        return true;
                    }
                } else if ($(this).attr("ajaxurl") && Validform.util.isEmpty.call($(this), inputval)) {
                    Validform.util.abort.call(this);
                    this.validform_valid = "true";
                }

                Validform.util.showmsg.call(curform, inflag.info, settings.tiptype, {obj: $(this), type: inflag.type, sweep: settings.tipSweep});
                _this.removeClass("Validform_error");
                errorobj = null;
            });

            if (settings.showAllError) {
                curform.find(".Validform_error:first").focus();
            }

            if (flag) {
                var beforeSubmit = settings.beforeSubmit && settings.beforeSubmit(curform);
                if (beforeSubmit === false) {
                    return false;
                }

                curform[0].validform_status = "posting";

                var config = curform[0].validform_config || {}

                if (settings.ajaxPost || ajaxPost === "ajaxPost") {
                    //è·å–é…ç½®å‚æ•°;
                    var ajaxsetup = config.ajaxpost || {};
                    //æœ‰å¯èƒ½éœ€è¦åŠ¨æ€çš„æ”¹å˜æäº¤åœ°å€ï¼Œæ‰€ä»¥æŠŠactionæ‰€æŒ‡å®šçš„urlå±‚çº§è®¾ä¸ºæœ€ä½?;
                    ajaxsetup.url = url || ajaxsetup.url || config.url || curform.attr("action");

                    //byajaxï¼šajaxæ—¶ï¼Œtiptyeä¸?1ã€?2æˆ?3éœ€è¦å¼¹å‡ºæç¤ºæ¡†;
                    //å¦‚æœsetupé‡Œå·²ç»è‡ªå®šä¹‰äº†successæˆ–erroræ–¹æ³•ï¼Œè¿™é‡Œä¸æ˜¾ç¤ºæç¤ºä¿¡æ¯;
                    ajaxsetup.success || ajaxsetup.error || Validform.util.showmsg.call(curform, curform.data("tipmsg").p || tipmsg.p, settings.tiptype, {
                        obj: curform,
                        type: 1,
                        sweep: settings.tipSweep
                    }, "byajax");

                    //æ–¹æ³•é‡Œçš„ä¼˜å…ˆçº§è¦é«?;
                    //æœ‰undefinedæƒ…å†µ;
                    if (sync) {
                        ajaxsetup.async = false;
                    } else if (sync === false) {
                        ajaxsetup.async = true;
                    }

                    if (ajaxsetup.success) {
                        var temp_suc = ajaxsetup.success;
                        ajaxsetup.success = function (data) {
                            settings.callback && settings.callback(data);
                            curform[0].validform_ajax = null;
                            if ($.trim(data.status) === "y") {
                                curform[0].validform_status = "posted";
                            } else {
                                curform[0].validform_status = "normal";
                            }

                            temp_suc(data, curform);
                        }
                    }

                    if (ajaxsetup.error) {
                        var temp_err = ajaxsetup.error;
                        ajaxsetup.error = function (data) {
                            settings.callback && settings.callback(data);
                            curform[0].validform_status = "normal";
                            curform[0].validform_ajax = null;

                            temp_err(data, curform);
                        }
                    }

                    var localconfig = {
                        type: "POST",
                        async: true,
                        data: curform.serializeArray(),
                        success: function (data) {
                            if ($.trim(data.status) === "y") {
                                //æˆåŠŸæäº¤;
                                curform[0].validform_status = "posted";
                                Validform.util.showmsg.call(curform, data.info, settings.tiptype, {obj: curform, type: 2, sweep: settings.tipSweep}, "byajax");
                            } else {
                                //æäº¤å‡ºé”™;
                                curform[0].validform_status = "normal";
                                Validform.util.showmsg.call(curform, data.info, settings.tiptype, {obj: curform, type: 3, sweep: settings.tipSweep}, "byajax");
                            }

                            settings.callback && settings.callback(data);
                            curform[0].validform_ajax = null;
                        },
                        error: function (data) {
                            var msg = "status: " + data.status + "; statusText: " + data.statusText;

                            Validform.util.showmsg.call(curform, msg, settings.tiptype, {obj: curform, type: 3, sweep: settings.tipSweep}, "byajax");

                            settings.callback && settings.callback(data);
                            curform[0].validform_status = "normal";
                            curform[0].validform_ajax = null;
                        }
                    }

                    ajaxsetup = $.extend({}, localconfig, ajaxsetup, {dataType: "json"});

                    curform[0].validform_ajax = $.ajax(ajaxsetup);

                } else {
                    if (!settings.postonce) {
                        curform[0].validform_status = "normal";
                    }

                    var url = url || config.url;
                    if (url) {
                        curform.attr("action", url);
                    }

                    return settings.callback && settings.callback(curform);
                }
            }

            return false;

        },

        resetForm: function () {
            var brothers = this;
            brothers.each(function () {
                this.reset();
                this.validform_status = "normal";
            });

            brothers.find(".Validform_right").text("");
            brothers.find(".passwordStrength").children().removeClass("bgStrength");
            brothers.find(".Validform_checktip").removeClass("Validform_wrong Validform_right Validform_loading");
            brothers.find(".Validform_error").removeClass("Validform_error");
            brothers.find("[datatype]").removeData("cked").removeData("dataIgnore").each(function () {
                this.validform_lastval = null;
            });
            brothers.eq(0).find("input:first").focus();
        },

        abort: function () {
            if (this.validform_ajax) {
                this.validform_ajax.abort();
            }
        }

    }

    $.Datatype = Validform.util.dataType;

    Validform.prototype = {
        dataType: Validform.util.dataType,

        eq: function (n) {
            var obj = this;

            if (n >= obj.forms.length) {
                return null;
            }

            if (!(n in obj.objects)) {
                obj.objects[n] = new Validform($(obj.forms[n]).get(), obj.settings, true);
            }

            return obj.objects[n];

        },

        resetStatus: function () {
            var obj = this;
            $(obj.forms).each(function () {
                this.validform_status = "normal";
            });

            return this;
        },

        setStatus: function (status) {
            var obj = this;
            $(obj.forms).each(function () {
                this.validform_status = status || "posting";
            });

            return this;
        },

        getStatus: function () {
            var obj = this;
            var status = $(obj.forms)[0].validform_status;

            return status;
        },

        ignore: function (selector) {
            var obj = this;
            var selector = selector || "[datatype]"

            $(obj.forms).find(selector).each(function () {
                $(this).data("dataIgnore", "dataIgnore").removeClass("Validform_error");
            });

            return this;
        },

        unignore: function (selector) {
            var obj = this;
            var selector = selector || "[datatype]"

            $(obj.forms).find(selector).each(function () {
                $(this).removeData("dataIgnore");
            });

            return this;
        },

        addRule: function (rule) {
            /*
             rule => [{
             ele:"#id",
             datatype:"*",
             errormsg:"å‡ºé”™æç¤ºæ–‡å­—ï¼?",
             nullmsg:"ä¸ºç©ºæ—¶çš„æç¤ºæ–‡å­—ï¼?",
             tip:"é»˜è®¤æ˜¾ç¤ºçš„æç¤ºæ–‡å­?",
             altercss:"gray",
             ignore:"ignore",
             ajaxurl:"valid.php",
             recheck:"password",
             plugin:"passwordStrength"
             },{},{},...]
             */
            var obj = this;
            var rule = rule || [];

            for (var index = 0; index < rule.length; index++) {
                var o = $(obj.forms).find(rule[index].ele);
                for (var attr in rule[index]) {
                    attr !== "ele" && o.attr(attr, rule[index][attr]);
                }
            }

            $(obj.forms).each(function () {
                var $this = $(this);
                Validform.util.enhance.call($this, obj.settings.tiptype, obj.settings.usePlugin, obj.settings.tipSweep, "addRule");
            });

            return this;
        },

        ajaxPost: function (flag, sync, url) {
            var obj = this;

            //åˆ›å»ºpop box;
            if (obj.settings.tiptype == 1 || obj.settings.tiptype == 2 || obj.settings.tiptype == 3) {
                creatMsgbox();
            }

            Validform.util.submitForm.call($(obj.forms[0]), obj.settings, flag, url, "ajaxPost", sync);

            return this;
        },

        submitForm: function (flag, url) {
            /*flag===trueæ—¶ä¸åšéªŒè¯ç›´æ¥æäº?*/


            var obj = this;

            //è®©è¯¥å¯¹è±¡çš„ç¬¬ä¸€ä¸ªè¡¨å•æäº?;
            var subflag = Validform.util.submitForm.call($(obj.forms[0]), obj.settings, flag, url);
            subflag === undef && (subflag = true);
            if (subflag === true) {
                obj.forms[0].submit();
            }

            return this;
        },

        resetForm: function () {
            var obj = this;
            Validform.util.resetForm.call($(obj.forms));

            return this;
        },

        abort: function () {
            var obj = this;
            $(obj.forms).each(function () {
                Validform.util.abort.call(this);
            });

            return this;
        },

        check: function (bool, selector) {
            /*
             boolï¼šä¼ å…¥trueï¼Œåªæ£€æµ‹ä¸æ˜¾ç¤ºæç¤ºä¿¡æ¯;
             */

            var selector = selector || "[datatype]",
                obj = this,
                curform = $(obj.forms),
                flag = true;

            curform.find(selector).each(function () {
                Validform.util.check.call(this, curform, obj, "", bool) || (flag = false);
            });

            return flag;
        },

        config: function (setup) {
            /*
             config={
             url:"ajaxpost.php",//æŒ‡å®šäº†urlåï¼Œæ•°æ®ä¼šæäº¤åˆ°è¿™ä¸ªåœ°å€;
             ajaxurl:{
             timeout:1000,
             ...
             },
             ajaxpost:{
             timeout:1000,
             ...
             }
             }
             */
            var obj = this;
            setup = setup || {};
            $(obj.forms).each(function () {
                this.validform_config = $.extend(true, this.validform_config, setup);
            });

            return this;
        }
    }

    $.fn.Validform = function (settings) {
        return new Validform(this, settings);
    };

    function setCenter(obj, time) {
        var left = ($(window).width() - obj.outerWidth()) / 2,
            top = ($(window).height() - obj.outerHeight()) / 2,

            top = (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + (top > 0 ? top : 0);

        obj.css({
            left: left
        }).animate({
            top: top
        }, {duration: time, queue: false});
    }

    function creatMsgbox() {
        if ($("#Validform_msg").length !== 0) {
            return false;
        }
        msgobj = $('<div id="Validform_msg"><div class="Validform_title">' + tipmsg.tit + '<a class="Validform_close" href="javascript:void(0);">&chi;</a></div><div class="Validform_info"></div><div class="iframe"><iframe frameborder="0" scrolling="no" height="100%" width="100%"></iframe></div></div>').appendTo("body");//æç¤ºä¿¡æ¯æ¡?;
        msgobj.find("a.Validform_close").click(function () {
            msgobj.hide();
            msghidden = true;
            if (errorobj) {
                errorobj.focus().addClass("Validform_error");
            }
            return false;
        }).focus(function () {
            this.blur();
        });

        $(window).bind("scroll resize", function () {
            !msghidden && setCenter(msgobj, 400);
        });
    };

    //å…¬ç”¨æ–¹æ³•æ˜¾ç¤º&å…³é—­ä¿¡æ¯æç¤ºæ¡?;
    $.Showmsg = function (msg) {
        creatMsgbox();
        Validform.util.showmsg.call(win, msg, 1, {});
    };

    $.Hidemsg = function () {
        msgobj.hide();
        msghidden = true;
    };

})(jQuery, window);